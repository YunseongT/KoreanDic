<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œêµ­ì–´ ë‹¨ì–´ í™•ì¥ ì‚¬ì „</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .search-section {
            padding: 30px;
            background: white;
        }

        .search-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            max-width: 600px;
            margin: 0 auto 20px auto;
        }

        .search-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 50px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.2);
        }

        .search-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results {
            padding: 0 30px 30px;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .category-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .category-card:hover {
            transform: translateY(-5px);
        }

        .category-header {
            padding: 20px;
            font-weight: 700;
            font-size: 1.2rem;
            color: white;
            text-align: center;
        }

        .definition .category-header {
            background: linear-gradient(135deg, #FF6B6B, #FF8E8E);
        }

        .homonym .category-header {
            background: linear-gradient(135deg, #4ECDC4, #6DD5D1);
        }

        .synonym .category-header {
            background: linear-gradient(135deg, #45B7D1, #69C9E0);
        }

        .antonym .category-header {
            background: linear-gradient(135deg, #96CEB4, #A8D8C4);
        }

        .rhyme .category-header {
            background: linear-gradient(135deg, #FECA57, #FED766);
        }

        .category-content {
            padding: 20px;
        }

        .definition-text {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #333;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #FF6B6B;
        }

        .word-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .word-tag {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .homonym-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #4ECDC4;
        }

        .homonym-item .word {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .homonym-item .definition {
            color: #666;
            line-height: 1.5;
        }

        .empty-state {
            text-align: center;
            color: #999;
            font-style: italic;
            padding: 20px;
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 20px;
            border-radius: 8px;
            margin: 20px;
            text-align: center;
            border: 1px solid #ffcdd2;
        }

        .api-status {
            background: #e3f2fd;
            color: #1976d2;
            padding: 15px;
            border-radius: 8px;
            margin: 20px;
            text-align: center;
            border: 1px solid #bbdefb;
            font-size: 0.9rem;
        }

        .proxy-status {
            background: #f3e5f5;
            color: #7b1fa2;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 0.85rem;
        }

        @media (max-width: 768px) {
            .category-grid {
                grid-template-columns: 1fr;
            }
            
            .search-container {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š í•œêµ­ì–´ ë‹¨ì–´ í™•ì¥ ì‚¬ì „</h1>
            <p>ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì—¬ ì •ì˜, ë™ìŒì´ì˜ì–´, ìœ ì˜ì–´, ë°˜ì˜ì–´, ê°ìš´ì„ ì°¾ì•„ë³´ì„¸ìš”</p>
        </div>

        <div class="search-section">
            <div class="search-container">
                <input type="text" class="search-input" placeholder="ê²€ìƒ‰í•  ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì‚¬ê³¼, ë§, ë°°, ë¹›, ë¬¼)" id="searchInput">
                <button class="search-btn" onclick="searchWord()">ğŸ” ì°¾ê¸°</button>
            </div>
            <div class="api-status">
                ğŸŒ ì‹¤ì‹œê°„ êµ­ë¦½êµ­ì–´ì› ìš°ë¦¬ë§ìƒ˜ API ì—°ê²°
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p id="loadingText">ë‹¨ì–´ ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
            <div class="proxy-status" id="proxyStatus"></div>
        </div>

        <div class="results" id="results"></div>
    </div>

    <script>
        const API_KEY = '1735A5341E757DC9336240C30F8F24A7';
        
        // ì—¬ëŸ¬ CORS í”„ë¡ì‹œ ì„œë²„ ëª©ë¡ (ì•ˆì •ì„± í–¥ìƒ)
        const PROXY_SERVERS = [
            'https://api.allorigins.win/get?url=',
            'https://corsproxy.io/?',
            'https://api.codetabs.com/v1/proxy?quest=',
            'https://cors-anywhere.herokuapp.com/',
            'https://thingproxy.freeboard.io/fetch/'
        ];
        
        let currentProxyIndex = 0;

        // Enter í‚¤ë¡œ ê²€ìƒ‰ ê°€ëŠ¥í•˜ê²Œ í•˜ê¸°
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchWord();
            }
        });

        async function searchWord() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            if (!searchTerm) {
                alert('ê²€ìƒ‰í•  ë‹¨ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            showLoading();
            await trySearchWithMultipleProxies(searchTerm);
        }

        async function trySearchWithMultipleProxies(searchTerm) {
            for (let i = 0; i < PROXY_SERVERS.length; i++) {
                currentProxyIndex = i;
                updateProxyStatus(`í”„ë¡ì‹œ ì„œë²„ ${i + 1}/${PROXY_SERVERS.length} ì‹œë„ ì¤‘...`);
                
                try {
                    const result = await searchWithProxy(searchTerm, i);
                    if (result) {
                        hideLoading();
                        displayResults(searchTerm, result);
                        return;
                    }
                } catch (error) {
                    console.log(`í”„ë¡ì‹œ ì„œë²„ ${i + 1} ì‹¤íŒ¨:`, error.message);
                    
                    if (i === PROXY_SERVERS.length - 1) {
                        // ëª¨ë“  í”„ë¡ì‹œ ì‹¤íŒ¨ì‹œ ì§ì ‘ í˜¸ì¶œ ì‹œë„
                        try {
                            updateProxyStatus('ì§ì ‘ API í˜¸ì¶œ ì‹œë„ ì¤‘...');
                            const result = await searchDirectly(searchTerm);
                            if (result) {
                                hideLoading();
                                displayResults(searchTerm, result);
                                return;
                            }
                        } catch (directError) {
                            console.log('ì§ì ‘ í˜¸ì¶œë„ ì‹¤íŒ¨:', directError.message);
                        }
                        
                        hideLoading();
                        showError(`ëª¨ë“  ì—°ê²° ë°©ë²•ì„ ì‹œë„í–ˆì§€ë§Œ APIì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>
                                  ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê³  ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.<br>
                                  <small>ì˜¤ë¥˜: CORS ì •ì±… ë˜ëŠ” ì„œë²„ ì ‘ê·¼ ì œí•œ</small>`);
                    }
                }
                
                // ë‹¤ìŒ í”„ë¡ì‹œ ì‹œë„ ì „ ì ì‹œ ëŒ€ê¸°
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
        }

        async function searchWithProxy(searchTerm, proxyIndex) {
            const proxy = PROXY_SERVERS[proxyIndex];
            const apiUrl = `https://opendict.korean.go.kr/api/search.do?key=${API_KEY}&q=${encodeURIComponent(searchTerm)}&req_type=json&part=word&pos=1&start=1&num=30`;
            
            let requestUrl;
            if (proxy.includes('allorigins.win')) {
                requestUrl = `${proxy}${encodeURIComponent(apiUrl)}`;
            } else {
                requestUrl = proxy + apiUrl;
            }

            const response = await fetch(requestUrl, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                },
                timeout: 10000
            });

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }

            const data = await response.json();
            
            // allorigins.winì˜ ê²½ìš° contents ì†ì„±ì— ì‹¤ì œ ë°ì´í„°ê°€ ìˆìŒ
            let apiData;
            if (data.contents) {
                try {
                    apiData = JSON.parse(data.contents);
                } catch (e) {
                    apiData = data.contents;
                }
            } else {
                apiData = data;
            }

            if (apiData && (apiData.channel || apiData.item)) {
                return apiData;
            }
            
            throw new Error('ì‘ë‹µ ë°ì´í„°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤');
        }

        async function searchDirectly(searchTerm) {
            // ì§ì ‘ API í˜¸ì¶œ (CORS ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆì§€ë§Œ ì‹œë„)
            const apiUrl = `https://opendict.korean.go.kr/api/search.do?key=${API_KEY}&q=${encodeURIComponent(searchTerm)}&req_type=json&part=word&pos=1&start=1&num=30`;
            
            const response = await fetch(apiUrl, {
                method: 'GET',
                mode: 'cors'
            });
            
            return await response.json();
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').innerHTML = '';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function updateProxyStatus(message) {
            document.getElementById('proxyStatus').textContent = message;
        }

        function showError(message) {
            document.getElementById('results').innerHTML = `<div class="error">${message}</div>`;
        }

        function displayResults(searchTerm, apiData) {
            let items = [];
            
            // ë‹¤ì–‘í•œ API ì‘ë‹µ í˜•ì‹ ì²˜ë¦¬
            if (apiData.channel && apiData.channel.item) {
                items = Array.isArray(apiData.channel.item) ? apiData.channel.item : [apiData.channel.item];
            } else if (apiData.item) {
                items = Array.isArray(apiData.item) ? apiData.item : [apiData.item];
            } else if (Array.isArray(apiData)) {
                items = apiData;
            }

            if (items.length === 0) {
                showError('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ë‹¨ì–´ë¡œ ì‹œë„í•´ë³´ì„¸ìš”.');
                return;
            }

            // ë°ì´í„° ë¶„ë¥˜ ë° ì²˜ë¦¬
            const mainDefinition = items[0];
            const homonyms = items.length > 1 ? items.slice(1) : [];
            
            // ê´€ë ¨ì–´ ì •ë³´ ì¶”ì¶œ
            const synonyms = new Set();
            const antonyms = new Set();
            
            items.forEach(item => {
                // ê´€ë ¨ì–´ ì •ë³´ì—ì„œ ìœ ì˜ì–´/ë°˜ì˜ì–´ ì¶”ì¶œ
                if (item.relation_info) {
                    extractRelatedWords(item.relation_info, synonyms, antonyms);
                }
                if (item.rel_info) {
                    extractRelatedWords(item.rel_info, synonyms, antonyms);
                }
                // ëœ»í’€ì´ì—ì„œ ê´€ë ¨ì–´ ì°¾ê¸°
                if (item.definition) {
                    extractFromDefinition(item.definition, synonyms, antonyms);
                }
            });

            // ê°ìš´ ì°¾ê¸°
            const allWords = [...synonyms, ...antonyms];
            const rhymes = findRhymingWords(searchTerm, allWords);

            const resultsHtml = `
                <div class="category-grid">
                    <!-- 1. ê²€ìƒ‰ ë‹¨ì–´ ì •ì˜ -->
                    <div class="category-card definition">
                        <div class="category-header">
                            ğŸ“– ê²€ìƒ‰ ë‹¨ì–´ ì •ì˜
                        </div>
                        <div class="category-content">
                            <div class="definition-text">
                                <strong>${searchTerm}</strong><br>
                                ${cleanDefinition(mainDefinition.definition)}
                                ${mainDefinition.pos ? `<br><small style="color: #666;">í’ˆì‚¬: ${mainDefinition.pos}</small>` : ''}
                            </div>
                        </div>
                    </div>

                    <!-- 2. ë™ìŒì´ì˜ì–´ -->
                    <div class="category-card homonym">
                        <div class="category-header">
                            ğŸ”„ ë™ìŒì´ì˜ì–´
                        </div>
                        <div class="category-content">
                            ${homonyms.length > 0 ? 
                                homonyms.map((item, index) => `
                                    <div class="homonym-item">
                                        <div class="word">${item.word || searchTerm} (${index + 2})</div>
                                        <div class="definition">${cleanDefinition(item.definition)}</div>
                                        ${item.pos ? `<small style="color: #888;">í’ˆì‚¬: ${item.pos}</small>` : ''}
                                    </div>
                                `).join('') : 
                                '<div class="empty-state">ë™ìŒì´ì˜ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>'
                            }
                        </div>
                    </div>

                    <!-- 3. ìœ ì˜ì–´ -->
                    <div class="category-card synonym">
                        <div class="category-header">
                            ğŸ‘¥ ìœ ì˜ì–´ (${synonyms.size}ê°œ)
                        </div>
                        <div class="category-content">
                            ${synonyms.size > 0 ? 
                                `<div class="word-list">
                                    ${Array.from(synonyms).map(word => `<span class="word-tag">${word}</span>`).join('')}
                                </div>` : 
                                '<div class="empty-state">ìœ ì˜ì–´ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>'
                            }
                        </div>
                    </div>

                    <!-- 4. ë°˜ì˜ì–´ -->
                    <div class="category-card antonym">
                        <div class="category-header">
                            â†”ï¸ ë°˜ì˜ì–´ (${antonyms.size}ê°œ)
                        </div>
                        <div class="category-content">
                            ${antonyms.size > 0 ? 
                                `<div class="word-list">
                                    ${Array.from(antonyms).map(word => `<span class="word-tag">${word}</span>`).join('')}
                                </div>` : 
                                '<div class="empty-state">ë°˜ì˜ì–´ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>'
                            }
                        </div>
                    </div>

                    <!-- 5. ê°ìš´ì´ ë§ëŠ” ë‹¨ì–´ -->
                    <div class="category-card rhyme">
                        <div class="category-header">
                            ğŸµ ê°ìš´ì´ ë§ëŠ” ë‹¨ì–´ (${rhymes.length}ê°œ)
                        </div>
                        <div class="category-content">
                            ${rhymes.length > 0 ? 
                                `<div class="word-list">
                                    ${rhymes.map(word => `<span class="word-tag">${word}</span>`).join('')}
                                </div>` : 
                                '<div class="empty-state">ê°ìš´ì´ ë§ëŠ” ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>'
                            }
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('results').innerHTML = resultsHtml;
        }

        function extractRelatedWords(relationInfo, synonyms, antonyms) {
            if (!relationInfo) return;
            
            const text = relationInfo.toString().toLowerCase();
            
            // ìœ ì˜ì–´ íŒ¨í„´ ë§¤ì¹­
            const synonymPatterns = [/ë¹„ìŠ·í•œë§[:\s]*([^,]+)/g, /ìœ ì˜ì–´[:\s]*([^,]+)/g, /ê°™ì€ë§[:\s]*([^,]+)/g];
            synonymPatterns.forEach(pattern => {
                let match;
                while ((match = pattern.exec(text)) !== null) {
                    const words = match[1].split(/[,\s]+/).filter(w => w.length > 0 && w !== 'ì—†ìŒ');
                    words.forEach(word => synonyms.add(word.trim()));
                }
            });

            // ë°˜ì˜ì–´ íŒ¨í„´ ë§¤ì¹­
            const antonymPatterns = [/ë°˜ì˜ì–´[:\s]*([^,]+)/g, /ë°˜ëŒ€ë§[:\s]*([^,]+)/g, /ëŒ€ì¡°ì–´[:\s]*([^,]+)/g];
            antonymPatterns.forEach(pattern => {
                let match;
                while ((match = pattern.exec(text)) !== null) {
                    const words = match[1].split(/[,\s]+/).filter(w => w.length > 0 && w !== 'ì—†ìŒ');
                    words.forEach(word => antonyms.add(word.trim()));
                }
            });
        }

        function extractFromDefinition(definition, synonyms, antonyms) {
            if (!definition) return;
            
            // ëœ»í’€ì´ì—ì„œ "~ì™€ ê°™ì€", "~ì˜ ë‹¤ë¥¸ ë§" ë“±ì˜ íŒ¨í„´ìœ¼ë¡œ ê´€ë ¨ì–´ ì°¾ê¸°
            const synonymPatterns = [
                /['"]([^'"]+)['"]ì™€\s*ê°™ì€/g,
                /['"]([^'"]+)['"]ì˜\s*ë‹¤ë¥¸\s*ë§/g,
                /['"]([^'"]+)['"]ë¼ê³ ë„/g
            ];
            
            synonymPatterns.forEach(pattern => {
                let match;
                while ((match = pattern.exec(definition)) !== null) {
                    synonyms.add(match[1].trim());
                }
            });
        }

        function findRhymingWords(searchTerm, wordList) {
            if (searchTerm.length === 0) return [];
            
            const lastChar = searchTerm.charAt(searchTerm.length - 1);
            const secondLastChar = searchTerm.length > 1 ? searchTerm.charAt(searchTerm.length - 2) : '';
            
            return wordList.filter(word => {
                if (word === searchTerm || word.length === 0) return false;
                
                // ë§ˆì§€ë§‰ ê¸€ìê°€ ê°™ê±°ë‚˜, ë§ˆì§€ë§‰ 2ê¸€ìê°€ ê°™ì€ ê²½ìš°
                const wordLastChar = word.charAt(word.length - 1);
                const wordSecondLastChar = word.length > 1 ? word.charAt(word.length - 2) : '';
                
                return wordLastChar === lastChar || 
                       (secondLastChar && wordSecondLastChar === secondLastChar && wordLastChar === lastChar);
            });
        }

        function cleanDefinition(definition) {
            if (!definition) return 'ì •ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.';
            
            return definition
                .replace(/<[^>]*>/g, '')
                .replace(/&lt;/g, '<')
                .replace(/&gt;/g, '>')
                .replace(/&amp;/g, '&')
                .replace(/&quot;/g, '"')
                .replace(/&#x27;/g, "'")
                .replace(/\s+/g, ' ')
                .trim();
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ ì•ˆë‚´
        window.addEventListener('load', function() {
            console.log('í•œêµ­ì–´ ë‹¨ì–´ í™•ì¥ ì‚¬ì „ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
            console.log('ë‹¤ì¤‘ í”„ë¡ì‹œ ì„œë²„ë¥¼ í†µí•´ ì•ˆì •ì ì¸ API ì—°ê²°ì„ ì œê³µí•©ë‹ˆë‹¤.');
        });
    </script>
</body>
</html>
